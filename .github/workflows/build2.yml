name: C_build2

on: [workflow_dispatch]

env:
  build_folder: ./build/gpredict-2.3.54

jobs:
  build_linux:

    runs-on: ubuntu-latest

    steps:
    - name: clone repo
      uses: actions/checkout@v3
    - name: create folder ./build
      run:  mkdir ./build   
      #Создаем папку с именем по правилу "<Имя_Программы>_<Версия>"
      #Чтобы в ней собирать .deb-пакет
    - name: create folder ./build/gpredict-2.3.54
      run:  mkdir ${{env.build_folder}}
      #копируем исходники
    - name: copying files
      run: mv ./* ${{env.build_folder}}
        # если ошибка на этом шаге - всё равно продолжаем
      continue-on-error: true 
    - name: sudo apt update
      run: sudo apt update
    - name: apt install
      run: |
        sudo apt install libtool intltool autoconf automake libcurl4-openssl-dev
        sudo apt install pkg-config libglib2.0-dev libgtk-3-dev libgoocanvas-2.0-dev
    - name: run ./autogen.sh
      run: | 
        cd ${{env.build_folder}}
        ./autogen.sh
    - name: make
      run: |
        cd ${{env.build_folder}}
        make
    - name: ls -lt ./build/gpredict-2.3.54
      run: ls -lt ${{env.build_folder}}
    - name: sudo apt-get install build-essential dh-make
      run: sudo apt-get install build-essential dh-make
    - name: dh_make --createorig --single --yes
      run: |
        cd ${{env.build_folder}}
        dh_make --createorig
#    - name: ls -lt ./build/gpredict-2.3.54
#      run: ls -lt ${{env.build_folder}}

    
  build_windows:

    runs-on: windows-latest
    defaults:
     run:
       shell: msys2 {0}
    
    steps:
    - name: clone repo
      uses: actions/checkout@v3
    - uses: msys2/setup-msys2@v2
      with:
        msystem: mingw32
        update: true #обновляем пакеты 
        install: mingw-w64-i686-pkg-config mingw-w64-i686-gtk3 mingw-w64-i686-goocanvas mingw-w64-x86_64-toolchain autotools #установим пакеты       
    - name: ---
      run: |
       # глянем, что содержат пакеты
       pacman -Ql  mingw-w64-i686-pkg-config
       pacman -Ql mingw-w64-i686-gtk3
       pacman -Ql mingw-w64-i686-goocanvas
       pacman -Ql mingw-w64-x86_64-toolchain
      continue-on-error: true 
    - name: dir  C:\msys64\mingw32\bin
      run: 
        dir C:\msys64\mingw32\bin
    - name: make
      run: |
        cd win32
        make



