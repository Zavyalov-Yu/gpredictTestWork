name: C_build2

on: [workflow_dispatch]

env:
  build_folder: ./build/gpredict-2.3.54

jobs:
  build_linux:

    runs-on: ubuntu-latest

    steps:
    - name: clone repo
      uses: actions/checkout@v3
    - name: create folder ./build
      run:  mkdir ./build   
      #Создаем папку с именем по правилу "<Имя_Программы>_<Версия>"
      #Чтобы в ней собирать .deb-пакет
    - name: create folder ./build/gpredict-2.3.54
      run:  mkdir ${{env.build_folder}}
      #копируем исходники
    - name: copying files
      run: mv ./* ${{env.build_folder}}
        # если ошибка на этом шаге - всё равно продолжаем
      continue-on-error: true 
    - name: sudo apt update
      run: sudo apt update
    - name: apt install
      run: |
        sudo apt install libtool intltool autoconf automake libcurl4-openssl-dev
        sudo apt install pkg-config libglib2.0-dev libgtk-3-dev libgoocanvas-2.0-dev
    - name: run ./autogen.sh
      run: | 
        cd ${{env.build_folder}}
        ./autogen.sh
    - name: make
      run: |
        cd ${{env.build_folder}}
        make
    - name: ls -lt ./build/gpredict-2.3.54
      run: ls -lt ${{env.build_folder}}
    - name: sudo apt-get install build-essential dh-make
      run: sudo apt-get install build-essential dh-make
    - name: dh_make --createorig --single --yes
      run: |
        cd ${{env.build_folder}}
        dh_make --createorig
#    - name: ls -lt ./build/gpredict-2.3.54
#      run: ls -lt ${{env.build_folder}}

    
  build_windows:

    runs-on: ubuntu-latest

    steps:
    - name: clone repo
      uses: actions/checkout@v3
    - name: sudo apt update
      run: sudo apt update
    - name: apt install
      run: |
        sudo apt install libtool intltool autoconf automake libcurl4-openssl-dev
        sudo apt install pkg-config libglib2.0-dev libgtk-3-dev libgoocanvas-2.0-dev
    - name: run ./autogen.sh --host=i686-w64-mingw32
      run: ./autogen.sh  --host=i686-w64-mingw32
    - name: make
      run: make
#    - name: sudo apt install mingw-w64
#      run: sudo apt install mingw-w64
#    - name: i686-w64-mingw32-gcc ./src/main.c -o gpredict.exe -static-libgcc -static-libstdc++ --verbose
#      run: i686-w64-mingw32-gcc ./src/main.c -o gpredict.exe -static-libgcc -static-libstdc++ --verbose
    - name: ls -lt 
      run: ls -lt 
      
